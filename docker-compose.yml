services:
  openwebui:
    image: 'ghcr.io/open-webui/open-webui:main'
    container_name: openwebui
    restart: unless-stopped
    ports:
      - '127.0.0.1:8080:8080'
    environment:
      - 'ENABLE_OLLAMA=${ENABLE_OLLAMA}'
      - 'OLLAMA_BASE_URL=${OLLAMA_BASE_URL}'
      - 'DEFAULT_LLM_PROVIDER=${DEFAULT_LLM_PROVIDER}'
    volumes:
      - '${OPENWEBUI_DATA}:/app/backend/data'
    healthcheck:
      test:
        - CMD
        - curl
        - '-f'
        - 'http://localhost:8080'
      interval: 10s
      timeout: 5s
      retries: 10
  gateway:
    image: 'nginx:alpine'
    container_name: syncro-gateway
    depends_on:
      openwebui:
        condition: service_healthy
    ports:
      - '3000:80'
    volumes:
      - './infra/nginx/nginx.conf:/etc/nginx/nginx.conf:ro'
